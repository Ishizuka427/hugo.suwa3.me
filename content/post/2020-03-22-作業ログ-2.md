---
title: "ä½œæ¥­ãƒ­ã‚°"
date: "2020-03-22T13:00:00.000Z"
categories: 
  - "log"
  - "tech-blog"
tags: 
  - "redis"
  - "vim"
---

3/22 TODO

- âœ…ã©ã‚“ã™ã‚diskfullå¯¾å‡¦  
    âœ…â†‘Redisã®è¨­å®š  
    ğŸ”³â†‘S3ç”»åƒã‚’è¡¨ç¤ºã•ã›ã‚‹
- âœ…ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ãƒšãƒ¼ã‚¸ã«2048ç§»æ¤
- âœ…vimç·¨é›†
- ğŸ”³WordPressè¨˜äº‹ã®QiitaåŒ– -> Gitç®¡ç†

# ã©ã‚“ã™ã‚diskfullå•é¡Œ

### diskfullã®ãŸã‚swapãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‰Šé™¤

0 => 200 => 400ã¨å¤‰æ›´

### ãƒ¡ãƒ¢ãƒªæ¯æ¸‡ã—ãŸãŸã‚Redisã®è¨­å®šã‚’å¤‰æ›´ã™ã‚‹

å‚ç…§: [Redisã®maxmemoryã«ã¤ã„ã¦ | æŠ€è¡“æƒ…å ±ãƒ–ãƒ­ã‚° | ãƒãƒãƒ¼ã‚¸ãƒ‰ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°ã®ãƒ‡ã‚£ãƒ¼ãƒãƒƒãƒˆ](https://www.denet.ad.jp/technology/2017/12/redismaxmemory.html)

ã¾ãšã¯ãƒã‚·ãƒ³å…¨ä½“ã®ãƒ¡ãƒ¢ãƒªå®¹é‡ã‚’ç¢ºèª

```
# free -th
              total        used        free      shared  buff/cache   available
Mem:           983M        779M         63M         60M        140M         34M
Swap:          399M        399M         40K
Total:         1.4G        1.2G         64M
```

ãƒ¡ã‚¤ãƒ³ãƒ¡ãƒ¢ãƒªã¯1GBã§ã—ãŸã€‚  
`maxmemory` ã®å€¤ã¯200MBã¨ã—ã¾ã™ã€‚  
ã•ã£ããç·¨é›†ã—ã¾ã™ã€‚

```
# cd /etc/
# vim redis.conf
maxmemory 200mb
```

Redisã‚µãƒ¼ãƒãƒ¼ã‚’å†èµ·å‹•ã—ã¾ã™ã€‚

```
# systemctl restart redis-server
```

ã¤ã„ã§ã«sidekiqã®`CPUQuota`ã‚‚5%ã«ã—ã¾ã—ãŸã€‚  
ãƒ‡ãƒ¼ãƒ¢ãƒ³ã‚’ãƒªãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„ã¨ã®ã“ã¨ã€‚

```
# service mastodon-sidekiq start
Warning: The unit file, source configuration file or drop-ins of mastodon-sidekiq.service changed on disk. Run 'systemctl daemon-reload' to reload units.

# systemctl daemon-reload
# service mastodon-sidekiq restart
```

ä»Šå¾Œã‚‚æ§˜å­ã‚’è¦‹ã¤ã¤ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°ã‚’ã—ã¦ã„ããŸã„ã§ã™ã€‚

# vimrcã®è¨­å®š

ç·¨é›†ã—ã¦ã¿ã¾ã—ãŸã€‚  
ã©ã‚“ã©ã‚“è¿½è¨˜ã—ã¦ã„ããŸã„ã§ã™ã€‚

```
$ vim ~/.vimrc
  1" è¡Œç•ªå·ã‚’è¡¨ç¤º
  2 set number
  3 
  4 "----------------------------------------
  5 " æ¤œç´¢
  6 "----------------------------------------
  7 " æ¤œç´¢ã™ã‚‹ã¨ãã«å¤§æ–‡å­—å°æ–‡å­—ã‚’åŒºåˆ¥ã—ãªã„
  8 set ignorecase
  9 " å°æ–‡å­—ã§æ¤œç´¢ã™ã‚‹ã¨å¤§æ–‡å­—ã¨å°æ–‡å­—ã‚’ç„¡è¦–ã—ã¦æ¤œç´¢
 10 set smartcase
 11 " æ¤œç´¢ãŒãƒ•ã‚¡ã‚¤ãƒ«æœ«å°¾ã¾ã§é€²ã‚“ã ã‚‰ã€ãƒ•ã‚¡ã‚¤ãƒ«å…ˆé ­ã‹ã‚‰å†ã³æ¤œç´¢
 12 set wrapscan
 13 " ã‚¤ãƒ³ã‚¯ãƒªãƒ¡ãƒ³ã‚¿ãƒ«æ¤œç´¢ (æ¤œç´¢ãƒ¯ãƒ¼ãƒ‰ã®æœ€åˆã®æ–‡å­—ã‚’å…¥åŠ›ã—ãŸæ™‚ç‚¹ã§æ¤œç´¢ãŒé–‹å§‹)
 14 set incsearch
 15 " æ¤œç´¢çµæœã‚’ãƒã‚¤ãƒ©ã‚¤ãƒˆè¡¨ç¤º
 16 set hlsearch
 17 
 18 "----------------------------------------
 19 " è¡¨ç¤ºè¨­å®š
 20 "----------------------------------------
 21 " è¡Œæœ«ã®ã‚¹ãƒšãƒ¼ã‚¹ã‚’å¯è¦–åŒ–
 22 set listchars=tab:^\ ,trail:~
 23 " ã‚³ãƒ¡ãƒ³ãƒˆã®è‰²ã‚’æ°´è‰²
 24 hi Comment ctermfg=LightBlue
```

# 2048ã‚’ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ãƒšãƒ¼ã‚¸ã«ç§»æ¤

2048ã¨ã„ã†ãƒ‘ã‚ºãƒ«ã‚²ãƒ¼ãƒ ã«ä¸€ç›®æƒšã‚Œã—ãŸã®ã§  
ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ãƒ¢ãƒ¼ãƒ‰ã«è¨­å®šã™ã‚‹ã“ã¨ã«ã—ã¾ã—ãŸã€‚

[GitHub/2048](https://github.com/gabrielecirulli/2048)

ãƒªãƒã‚¸ãƒˆãƒªã‚’ãƒ•ã‚©ãƒ¼ã‚¯ã—ã¦  
index.htmlã‚’ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ç”¨ã«ç·¨é›†ã™ã‚‹ã€‚

### nginxã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ•´ç†

nginxã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ãŒdefaultã¨ã„ã†åå‰ã«ãªã£ã¦ã„ã‚‹ãŸã‚  
ãƒ•ã‚¡ã‚¤ãƒ«åã‚’æ¬¡ã®ã‚ˆã†ã«å¤‰æ›´ã™ã‚‹ã€‚

```
# /etc/nginx/sites-available/default -> /etc/nginx/sites-available/don.suwa3.me
# mv /etc/nginx/sites-available/default /etc/nginx/sites-available/don.suwa3.me
```

ãã‚Œã«ä¼´ã„sites-enabledã®ã‚·ãƒ³ãƒœãƒªãƒƒã‚¯ãƒªãƒ³ã‚¯ã‚‚ä½œã‚Šç›´ã™ã€‚

```
unlink /etc/nginx/sites-enabled/default
ln -s /etc/nginx/sites-available/default /etc/nginx/sites-available/don.suwa3.me
```

### ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ç”¨ã®nginxã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¨­ç½®

`/etc/nginx/sites-available/default` ã‚’å…ƒã«  
ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ç”¨ã®nginxã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¨­ç½®ã€‚

```
cp /etc/nginx/sites-available/don.suwa3.me /etc/nginx/sites-available/don.suwa3.me-mainte
```

`/etc/nginx/sites-available/don.suwa3.me-mainte` ã®locationã‚’  
ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ç”¨ã«å¤‰æ›´ã€‚

æ—¢å­˜ã®locationå®£è¨€ã¯ã™ã¹ã¦å‰Šé™¤ã—ã€æ¬¡ã‚’è¿½åŠ ã™ã‚‹ã€‚

```
location / {
  root /var/www/don.suwa3.me-mainte
}
```

ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ãƒšãƒ¼ã‚¸ã‚’ec2ä¸Šã«è¨­ç½®ã—ã¾ã™ã€‚  
ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ç”¨ã®é™çš„ãƒ•ã‚¡ã‚¤ãƒ«ã®é…ç½®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆã€‚

```
mkdir -p /var/www/don.suwa3.me-mainte
```

ã‚«ãƒ¬ãƒ³ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ç§»å‹•

```
cd /var/www/don.suwa3.me-mainte
```

ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰

```
git clone https://github.com/Ishizuka427/2048.git .
```

ç´°ã‹ãªå¾®èª¿æ•´ãªã©ã¯ã®ã¡ã®ã¡è¡Œã„ã¾ã™ğŸ‘

![](/images/ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ-2020-03-22-20.58.10.png)
